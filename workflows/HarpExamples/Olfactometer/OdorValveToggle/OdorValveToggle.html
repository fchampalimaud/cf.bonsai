<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Odor Valve Toggle | CF.Bonsai </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Odor Valve Toggle | CF.Bonsai ">
      
      
      <link rel="icon" href="../../../../images/logo.svg">
      <link rel="stylesheet" href="../../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="../../../../articles/toc.html">
      
      <meta name="docfx:rel" content="../../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/fchampalimaud/cf.bonsai/blob/main/docs/workflows/HarpExamples/Olfactometer/OdorValveToggle/OdorValveToggle.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../../index.html">
            <img id="logo" class="svg" src="../../../../images/logo_white.svg" alt="CF.Bonsai">
            CF.Bonsai
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="odor-valve-toggle">Odor Valve Toggle</h1>

<h2 id="summary">Summary</h2>
<p>This example demonstrates how to configure the Harp Olfactometer to toggle the Odor Valves using the <a href="https://github.com/harp-tech/device.olfactometer">Harp Olfactometer</a> board (see hardware diagram below).</p>
<h2 id="workflow">Workflow</h2>
<div class="workflow"><p><img src="OdorValveToggle.bonsai" alt="Example"></p>
</div>
<h2 id="details">Details</h2>
<ol>
<li>Creates a subject node to send commands to the Olfactometer board and publishes all the events from the device. The PortName property in the Olfactometer node needs to be set to the COM device on the computer. To create the subject node, right-click on the Olfactometer node -&gt; Create Source -&gt; Behavior Subject, and name it accordingly.
<ol>
<li>Filters event messages associated with the Channel 0 flow rate.</li>
<li>Filters event messages associated with the Channel 1 flow rate.</li>
<li>Filters event messages associated with the Channel 4 flow rate.</li>
</ol>
</li>
<li>Enables the Olfactometer flow by pressing the 'B' key.</li>
<li>Disables the Olfactometer flow by pressing the 'E' key.</li>
<li>Enables the valves to be configured with hardware generated pulse.</li>
<li>Configures the value (in milliseconds) of the Odor valve 0 pulse.</li>
<li>Configures the value (in milliseconds) of the Odor valve 1 pulse.</li>
<li>Sets the target flow rate for all the channels of the olfactometer. If they are not used they are configure with zero value.</li>
<li>Ensures that command messages are sent only when the device is ready.</li>
<li>Sets the state of the different valves to perform a 500 ms odor delivery after 'A' key press.
<ol>
<li>Odor valve 0 is enabled 2 seconds before the Odor valve 1 toggles.</li>
<li>Odor valve 1 is enabled.</li>
</ol>
</li>
</ol>
<h2 id="requirements">Requirements</h2>
<p>This example requires the following Bonsai package:</p>
<ul>
<li>Harp.Olfactometer (from nuget.org) - make sure to select 'Include prerelease'</li>
</ul>
<h2 id="schematics">Schematics</h2>
<p>The <a href="https://github.com/harp-tech/device.olfactometer">Harp Olfactometer</a> supports up to 4 odor channels and 1 carrier line.</p>
<p>In this example, Channel 0 (odor line) is configured with a 80 ml/min flow rate, Channel 1 (odor line) with 80 ml/min and Channel 4 (carrier line) with 720 ml/min.</p>
<p>After 'A' key press the odor channel 0 flow is enabled, goes through the correspondent vial, mixes with the auxiliary carrier line and is delivered to the animal. The duration of the odor pulse is 500 ms. Then, 2 s after the enabling of odor channel 0, odor channel 1 is also enabled during 500 ms, mixed with the auxiliary carrier line and delivered to the animal.</p>
<p><img src="OdorValveToggle.png" width="80%" alt="Schematics"></p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/fchampalimaud/cf.bonsai/blob/main/docs/workflows/HarpExamples/Olfactometer/OdorValveToggle/OdorValveToggle.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>&copy; 2024 Champalimaud Foundation and Contributors</span> -<span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
